import 'package:ecoleti/locators/serviceLocator.dart';
import 'package:ecoleti/models/demande.dart';
import 'package:ecoleti/models/notice.dart';
import 'package:ecoleti/models/parentDTO.dart';
import 'package:ecoleti/models/post.dart';
import 'package:ecoleti/pages/posts/posts_provider.dart';
import 'package:ecoleti/providers/ecoletiProvider.dart';
import 'package:get/get.dart';

class PostsController extends GetxController {
  RxList<Demande> postsList = <Demande>[].obs;
  RxList<Notice> noticeList = <Notice>[].obs;
  ParentDTO? parentDTO;
  var isLoading = true.obs;
  @override
  void onInit() {
    initPost();
    initNotice();
    super.onInit();
  }

  initPost() {
    PostsProvider.getPostsList(
      onSuccess: (posts) {
        postsList.addAll(posts);
        isLoading(false);
        update();
      },
      onError: (error) {
        isLoading(false);
        update();
        print("Error");
      },
    );
  }

  initNotice() async {
    parentDTO = await serviceLocator.get<EcoletiProvider>().loadParentDTO();
    parentDTO!.students!.forEach((e) => {
          print(e.id),
          PostsProvider.getPostsNotice(
            StudentId: e.id,
            onSuccess: (notice) {
              noticeList.addAll(notice);
              isLoading(false);
              update();
            },
            onError: (error) {
              isLoading(false);
              update();
              print("Error");
            },
          )
        });
  }
}
